# 1. 字句構造（Lexical Structure）

本章は、ソースコードのテキストを**トークン列**に変換するための規則を定義します。

---

## 1.1 ソースコード表現

### 1.1.1 文字エンコーディング

ソースコードは **UTF-8** として解釈されなければなりません。不正な UTF-8 バイト列を含む場合、処理系は**字句エラー**を報告しなければなりません。

### 1.1.2 改行コード

行終端は **LF (`\n`)** または **CRLF (`\r\n`)** を許容します。

---

## 1.2 空白とコメント（Whitespace and Comments）

### 1.2.1 空白

```ebnf
whitespace = /\s+/ ;
```

空白は構文要素間で無視されます。

### 1.2.2 コメント

```ebnf
line_comment  = "//" , /[^\n]*/ ;
block_comment = "/*" , /[^*]*\*+([^/*][^*]*\*+)*/ , "/" ;
comment       = line_comment | block_comment ;
```

- コメントは空白と同様に無視されます。
- ブロックコメントの入れ子（ネスト）は**未規定**（TBD）です。

### 1.2.3 ドキュメンテーションコメント

```ebnf
inner_doc = "//!" , /[^\n]*/ ;
outer_doc = "///" , /[^\n]*/ ;
```

処理系は `inner_doc` / `outer_doc` を `line_comment` より優先して認識しなければなりません。

---

## 1.3 識別子とキーワード（Identifiers and Keywords）

### 1.3.1 識別子

```ebnf
identifier = /[a-zA-Z_][a-zA-Z0-9_]*/ - keyword ;
```

識別子はキーワードと一致してはなりません。

### 1.3.2 予約語（Keywords）

以下はキーワードとして予約されます。

```text
import  extern  type  var  const  tree  as
in  out  ref  mut
true  false  null
vec
string
action  subtree  condition  control  decorator
```

---

## 1.4 リテラル（Literals）

### 1.4.1 字句規則

```ebnf
string  = '"' , /([^"\\r\n]|\\.)*/ , '"' ;
float   = [ "-" ] , ( /[0-9]+/ , "." , /[0-9]+/ , [ exponent ]
     | /[0-9]+/ , exponent
     ) ;
exponent = ( "e" | "E" ) , [ "+" | "-" ] , /[0-9]+/ ;
integer = [ "-" ] , ( "0"
     | /[1-9][0-9]*/
     | "0x" , /[0-9a-fA-F]+/
     | "0b" , /[01]+/
     | "0o" , /[0-7]+/
     ) ;
boolean = "true" | "false" ;
null    = "null" ;
literal = string | float | integer | boolean | null ;
```

### 1.4.2 トークン化の優先順位

`float` は `integer` より優先してトークン化されなければなりません。

### 1.4.3 整数リテラル

- 10進、16進（`0x`）、2進（`0b`）、8進（`0o`）を許容します。
- 符号 `-` を許容します。
- 桁区切り（`_`）は**未サポート**です。

### 1.4.4 浮動小数点リテラル

整数部、`.`、小数部から成ります。指数表記（例: `1e3`, `1.5E-2`）をサポートします。

### 1.4.5 文字列リテラル

- `"..."` で囲まれます。
- `\\` によるエスケープを許容します。
- 文字列リテラル中に**生の改行**を含めてはなりません。

サポートされるエスケープシーケンスは [補足情報](../internals/lexical-structure-notes.md) を参照してください。

### 1.4.6 真偽値・Null

- 真偽値: `true` / `false`
- Null: `null`

---

## 1.5 記号と演算子（Punctuation and Operators）

### 1.5.1 区切り文字（Punctuation）

- 区切り: `;` `,` `:`
- 括弧: `{` `}` `(` `)` `[` `]`
- 属性: `#` `[` `]`（構文上は `#[ ... ]` として使用）
- 事前条件: `@`

### 1.5.2 演算子トークン

- 代入: `=` `+=` `-=` `*=` `/=`
- 論理: `||` `&&` `!`
- ビット: `|` `&` `^`
- 比較: `==` `!=` `<` `<=` `>` `>=`
- 算術: `+` `-` `*` `/` `%`
- キャスト: `as`
