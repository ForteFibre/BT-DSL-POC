================================================================================
Extern variants + defaults
================================================================================

extern decorator Retry(n: int32 = 3);
#[behavior(All, Isolated)]
extern control ParallelAll();
extern condition IsReady(in level: int32, out ok: bool);

tree Main() {
  ParallelAll {
    IsReady(level: 1, ok: out var ok);
  }
}

--------------------------------------------------------------------------------

(program
  (extern_stmt
    (extern_def
      (identifier)
      (extern_port_list
        (extern_port
          (identifier)
          (type
            (base_type
              (primary_type
                (identifier))))
          (const_expr
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (literal
                                        (integer))))))))))))))))))))
  (extern_stmt
    (behavior_attr
      (data_policy)
      (flow_policy))
    (extern_def
      (identifier)))
  (extern_stmt
    (extern_def
      (identifier)
      (extern_port_list
        (extern_port
          (port_direction)
          (identifier)
          (type
            (base_type
              (primary_type
                (identifier)))))
        (extern_port
          (port_direction)
          (identifier)
          (type
            (base_type
              (primary_type
                (identifier))))))))
  (tree_def
    (identifier)
    (tree_body
      (statement
        (block_stmt
          (compound_node_call
            (identifier)
            (node_body_with_children
              (children_block
                (statement
                  (simple_stmt
                    (leaf_node_call
                      (identifier)
                      (property_block
                        (argument_list
                          (argument
                            (identifier)
                            (argument_expr
                              (expression
                                (or_expr
                                  (and_expr
                                    (bitwise_or_expr
                                      (bitwise_xor_expr
                                        (bitwise_and_expr
                                          (equality_expr
                                            (comparison_expr
                                              (additive_expr
                                                (multiplicative_expr
                                                  (cast_expr
                                                    (unary_expr
                                                      (primary_expr
                                                        (literal
                                                          (integer)))))))))))))))))
                          (argument
                            (identifier)
                            (argument_expr
                              (inline_blackboard_decl
                                (identifier)))))))))))))))))

================================================================================
Doc comments on var/const (global + local)
================================================================================

/// global var docs
var X: int32 = 1;

/// global const docs
const Y: int32 = 2;

tree VarConstDocs() {
  /// local var docs
  var a: int32 = 0;

  /// local const docs
  const B: int32 = 1;

  AlwaysSuccess();
}

--------------------------------------------------------------------------------

(program
  (global_blackboard_decl
    (outer_doc)
    (identifier)
    (type
      (base_type
        (primary_type
          (identifier))))
    (expression
      (or_expr
        (and_expr
          (bitwise_or_expr
            (bitwise_xor_expr
              (bitwise_and_expr
                (equality_expr
                  (comparison_expr
                    (additive_expr
                      (multiplicative_expr
                        (cast_expr
                          (unary_expr
                            (primary_expr
                              (literal
                                (integer))))))))))))))))
  (global_const_decl
    (outer_doc)
    (identifier)
    (type
      (base_type
        (primary_type
          (identifier))))
    (const_expr
      (expression
        (or_expr
          (and_expr
            (bitwise_or_expr
              (bitwise_xor_expr
                (bitwise_and_expr
                  (equality_expr
                    (comparison_expr
                      (additive_expr
                        (multiplicative_expr
                          (cast_expr
                            (unary_expr
                              (primary_expr
                                (literal
                                  (integer)))))))))))))))))
  (tree_def
    (identifier)
    (tree_body
      (statement
        (simple_stmt
          (blackboard_decl
            (outer_doc)
            (identifier)
            (type
              (base_type
                (primary_type
                  (identifier))))
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (literal
                                        (integer))))))))))))))))))
      (statement
        (simple_stmt
          (local_const_decl
            (outer_doc)
            (identifier)
            (type
              (base_type
                (primary_type
                  (identifier))))
            (const_expr
              (expression
                (or_expr
                  (and_expr
                    (bitwise_or_expr
                      (bitwise_xor_expr
                        (bitwise_and_expr
                          (equality_expr
                            (comparison_expr
                              (additive_expr
                                (multiplicative_expr
                                  (cast_expr
                                    (unary_expr
                                      (primary_expr
                                        (literal
                                          (integer)))))))))))))))))))
      (statement
        (simple_stmt
          (leaf_node_call
            (identifier)
            (property_block)))))))

================================================================================
Type forms (nullable / bounded string / arrays / vec / infer)
================================================================================

extern type Vector3;
type MaybeVec = vec<_>?;

tree Types(
  in name: string<32> = "abc",
  out pos: Vector3?
) {
  var a: [int32; <=4] = [];
  var b: [_; 4] = [0; 4];
  var c: vec<int32> = vec![1, 2, 3];
  pos = null;
}

--------------------------------------------------------------------------------

(program
  (extern_type_stmt
    (identifier))
  (type_alias_stmt
    (identifier)
    (type
      (base_type
        (dynamic_array_type
          (type
            (base_type
              (infer_type
                (infer_type_wildcard))))))))
  (tree_def
    (identifier)
    (param_list
      (param_decl
        (port_direction)
        (identifier)
        (type
          (base_type
            (primary_type
              (bounded_string
                (array_size
                  (integer))))))
        (const_expr
          (expression
            (or_expr
              (and_expr
                (bitwise_or_expr
                  (bitwise_xor_expr
                    (bitwise_and_expr
                      (equality_expr
                        (comparison_expr
                          (additive_expr
                            (multiplicative_expr
                              (cast_expr
                                (unary_expr
                                  (primary_expr
                                    (literal
                                      (string)))))))))))))))))
      (param_decl
        (port_direction)
        (identifier)
        (type
          (base_type
            (primary_type
              (identifier))))))
    (tree_body
      (statement
        (simple_stmt
          (blackboard_decl
            (identifier)
            (type
              (base_type
                (static_array_type
                  (type
                    (base_type
                      (primary_type
                        (identifier))))
                  (array_size_spec
                    (array_size
                      (integer))))))
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (array_literal)))))))))))))))))
      (statement
        (simple_stmt
          (blackboard_decl
            (identifier)
            (type
              (base_type
                (static_array_type
                  (type
                    (base_type
                      (infer_type
                        (infer_type_wildcard))))
                  (array_size_spec
                    (array_size
                      (integer))))))
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (array_literal
                                        (repeat_init
                                          (expression
                                            (or_expr
                                              (and_expr
                                                (bitwise_or_expr
                                                  (bitwise_xor_expr
                                                    (bitwise_and_expr
                                                      (equality_expr
                                                        (comparison_expr
                                                          (additive_expr
                                                            (multiplicative_expr
                                                              (cast_expr
                                                                (unary_expr
                                                                  (primary_expr
                                                                    (literal
                                                                      (integer)))))))))))))))
                                          (expression
                                            (or_expr
                                              (and_expr
                                                (bitwise_or_expr
                                                  (bitwise_xor_expr
                                                    (bitwise_and_expr
                                                      (equality_expr
                                                        (comparison_expr
                                                          (additive_expr
                                                            (multiplicative_expr
                                                              (cast_expr
                                                                (unary_expr
                                                                  (primary_expr
                                                                    (literal
                                                                      (integer)))))))))))))))))))))))))))))))))
      (statement
        (simple_stmt
          (blackboard_decl
            (identifier)
            (type
              (base_type
                (dynamic_array_type
                  (type
                    (base_type
                      (primary_type
                        (identifier)))))))
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (vec_macro
                                        (array_literal
                                          (element_list
                                            (expression
                                              (or_expr
                                                (and_expr
                                                  (bitwise_or_expr
                                                    (bitwise_xor_expr
                                                      (bitwise_and_expr
                                                        (equality_expr
                                                          (comparison_expr
                                                            (additive_expr
                                                              (multiplicative_expr
                                                                (cast_expr
                                                                  (unary_expr
                                                                    (primary_expr
                                                                      (literal
                                                                        (integer)))))))))))))))
                                            (expression
                                              (or_expr
                                                (and_expr
                                                  (bitwise_or_expr
                                                    (bitwise_xor_expr
                                                      (bitwise_and_expr
                                                        (equality_expr
                                                          (comparison_expr
                                                            (additive_expr
                                                              (multiplicative_expr
                                                                (cast_expr
                                                                  (unary_expr
                                                                    (primary_expr
                                                                      (literal
                                                                        (integer)))))))))))))))
                                            (expression
                                              (or_expr
                                                (and_expr
                                                  (bitwise_or_expr
                                                    (bitwise_xor_expr
                                                      (bitwise_and_expr
                                                        (equality_expr
                                                          (comparison_expr
                                                            (additive_expr
                                                              (multiplicative_expr
                                                                (cast_expr
                                                                  (unary_expr
                                                                    (primary_expr
                                                                      (literal
                                                                        (integer))))))))))))))))))))))))))))))))))
      (statement
        (simple_stmt
          (assignment_stmt
            (lvalue
              (identifier))
            (assignment_op)
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (literal
                                        (null)))))))))))))))))))))

================================================================================
Chained casts (a as T1 as T2)
================================================================================

tree ChainedCasts() {
  var x: int64 = y as int32 as int64;
}

--------------------------------------------------------------------------------

(program
  (tree_def
    (identifier)
    (tree_body
      (statement
        (simple_stmt
          (blackboard_decl
            (identifier)
            (type
              (base_type
                (primary_type
                  (identifier))))
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (identifier)))
                                  (type
                                    (base_type
                                      (primary_type
                                        (identifier))))
                                  (type
                                    (base_type
                                      (primary_type
                                        (identifier)))))))))))))))))))))

================================================================================
Compound node call with/without args
================================================================================

tree Blocks() {
  Sequence {
    Action1();
  }

  ParallelAll(failure_threshold: 1, success_threshold: -1) {
    Action2();
  }
}

--------------------------------------------------------------------------------

(program
  (tree_def
    (identifier)
    (tree_body
      (statement
        (block_stmt
          (compound_node_call
            (identifier)
            (node_body_with_children
              (children_block
                (statement
                  (simple_stmt
                    (leaf_node_call
                      (identifier)
                      (property_block)))))))))
      (statement
        (block_stmt
          (compound_node_call
            (identifier)
            (node_body_with_children
              (property_block
                (argument_list
                  (argument
                    (identifier)
                    (argument_expr
                      (expression
                        (or_expr
                          (and_expr
                            (bitwise_or_expr
                              (bitwise_xor_expr
                                (bitwise_and_expr
                                  (equality_expr
                                    (comparison_expr
                                      (additive_expr
                                        (multiplicative_expr
                                          (cast_expr
                                            (unary_expr
                                              (primary_expr
                                                (literal
                                                  (integer)))))))))))))))))
                  (argument
                    (identifier)
                    (argument_expr
                      (expression
                        (or_expr
                          (and_expr
                            (bitwise_or_expr
                              (bitwise_xor_expr
                                (bitwise_and_expr
                                  (equality_expr
                                    (comparison_expr
                                      (additive_expr
                                        (multiplicative_expr
                                          (cast_expr
                                            (unary_expr
                                              (primary_expr
                                                (literal
                                                  (integer)))))))))))))))))))
              (children_block
                (statement
                  (simple_stmt
                    (leaf_node_call
                      (identifier)
                      (property_block))))))))))))

================================================================================
Expressions (precedence, indexing, casts)
================================================================================

tree Expressions() {
  var flags: int32 = 0;
  var mask: int32 = 255;
  flags = (mask & 15) | 16;
  var xs: vec<int32> = vec![1, 2, 3];
  xs[0] = (xs[1] + 2) as int32;
}

--------------------------------------------------------------------------------

(program
  (tree_def
    (identifier)
    (tree_body
      (statement
        (simple_stmt
          (blackboard_decl
            (identifier)
            (type
              (base_type
                (primary_type
                  (identifier))))
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (literal
                                        (integer))))))))))))))))))
      (statement
        (simple_stmt
          (blackboard_decl
            (identifier)
            (type
              (base_type
                (primary_type
                  (identifier))))
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (literal
                                        (integer))))))))))))))))))
      (statement
        (simple_stmt
          (assignment_stmt
            (lvalue
              (identifier))
            (assignment_op)
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (expression
                                        (or_expr
                                          (and_expr
                                            (bitwise_or_expr
                                              (bitwise_xor_expr
                                                (bitwise_and_expr
                                                  (equality_expr
                                                    (comparison_expr
                                                      (additive_expr
                                                        (multiplicative_expr
                                                          (cast_expr
                                                            (unary_expr
                                                              (primary_expr
                                                                (identifier))))))))
                                                  (equality_expr
                                                    (comparison_expr
                                                      (additive_expr
                                                        (multiplicative_expr
                                                          (cast_expr
                                                            (unary_expr
                                                              (primary_expr
                                                                (literal
                                                                  (integer))))))))))))))))))))))))
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (literal
                                        (integer))))))))))))))))))
      (statement
        (simple_stmt
          (blackboard_decl
            (identifier)
            (type
              (base_type
                (dynamic_array_type
                  (type
                    (base_type
                      (primary_type
                        (identifier)))))))
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (vec_macro
                                        (array_literal
                                          (element_list
                                            (expression
                                              (or_expr
                                                (and_expr
                                                  (bitwise_or_expr
                                                    (bitwise_xor_expr
                                                      (bitwise_and_expr
                                                        (equality_expr
                                                          (comparison_expr
                                                            (additive_expr
                                                              (multiplicative_expr
                                                                (cast_expr
                                                                  (unary_expr
                                                                    (primary_expr
                                                                      (literal
                                                                        (integer)))))))))))))))
                                            (expression
                                              (or_expr
                                                (and_expr
                                                  (bitwise_or_expr
                                                    (bitwise_xor_expr
                                                      (bitwise_and_expr
                                                        (equality_expr
                                                          (comparison_expr
                                                            (additive_expr
                                                              (multiplicative_expr
                                                                (cast_expr
                                                                  (unary_expr
                                                                    (primary_expr
                                                                      (literal
                                                                        (integer)))))))))))))))
                                            (expression
                                              (or_expr
                                                (and_expr
                                                  (bitwise_or_expr
                                                    (bitwise_xor_expr
                                                      (bitwise_and_expr
                                                        (equality_expr
                                                          (comparison_expr
                                                            (additive_expr
                                                              (multiplicative_expr
                                                                (cast_expr
                                                                  (unary_expr
                                                                    (primary_expr
                                                                      (literal
                                                                        (integer))))))))))))))))))))))))))))))))))
      (statement
        (simple_stmt
          (assignment_stmt
            (lvalue
              (identifier)
              (index_suffix
                (expression
                  (or_expr
                    (and_expr
                      (bitwise_or_expr
                        (bitwise_xor_expr
                          (bitwise_and_expr
                            (equality_expr
                              (comparison_expr
                                (additive_expr
                                  (multiplicative_expr
                                    (cast_expr
                                      (unary_expr
                                        (primary_expr
                                          (literal
                                            (integer)))))))))))))))))
            (assignment_op)
            (expression
              (or_expr
                (and_expr
                  (bitwise_or_expr
                    (bitwise_xor_expr
                      (bitwise_and_expr
                        (equality_expr
                          (comparison_expr
                            (additive_expr
                              (multiplicative_expr
                                (cast_expr
                                  (unary_expr
                                    (primary_expr
                                      (expression
                                        (or_expr
                                          (and_expr
                                            (bitwise_or_expr
                                              (bitwise_xor_expr
                                                (bitwise_and_expr
                                                  (equality_expr
                                                    (comparison_expr
                                                      (additive_expr
                                                        (multiplicative_expr
                                                          (cast_expr
                                                            (unary_expr
                                                              (primary_expr
                                                                (identifier)
                                                                (index_suffix
                                                                  (expression
                                                                    (or_expr
                                                                      (and_expr
                                                                        (bitwise_or_expr
                                                                          (bitwise_xor_expr
                                                                            (bitwise_and_expr
                                                                              (equality_expr
                                                                                (comparison_expr
                                                                                  (additive_expr
                                                                                    (multiplicative_expr
                                                                                      (cast_expr
                                                                                        (unary_expr
                                                                                          (primary_expr
                                                                                            (literal
                                                                                              (integer))))))))))))))))))))
                                                        (multiplicative_expr
                                                          (cast_expr
                                                            (unary_expr
                                                              (primary_expr
                                                                (literal
                                                                  (integer)))))))))))))))))
                                  (type
                                    (base_type
                                      (primary_type
                                        (identifier)))))))))))))))))))))

================================================================================
Docs + preconditions + empty children
================================================================================

/// A documented tree
tree Docs() {
  /// Guarded block
  @guard(enabled)
  Sequence {}
}

--------------------------------------------------------------------------------

(program
  (tree_def
    (outer_doc)
    (identifier)
    (tree_body
      (statement
        (block_stmt
          (compound_node_call
            (outer_doc)
            (precondition_list
              (precondition
                (precond_kind)
                (expression
                  (or_expr
                    (and_expr
                      (bitwise_or_expr
                        (bitwise_xor_expr
                          (bitwise_and_expr
                            (equality_expr
                              (comparison_expr
                                (additive_expr
                                  (multiplicative_expr
                                    (cast_expr
                                      (unary_expr
                                        (primary_expr
                                          (identifier))))))))))))))))
            (identifier)
            (node_body_with_children
              (children_block))))))))
